grammar org.xtext.example.mydsl.MyDsl with org.eclipse.xtext.common.Terminals

generate myDsl "http://www.xtext.org/example/mydsl/MyDsl"

Model:
	(nodes+=NodeDefinition
	| systems+=SystemDefinition
	| deployments+=Deployment)*;



NodeDefinition: 'node' name=ID ';';
NodeInstance: type=[NodeDefinition] name=ID;

SystemDefinition:
	'system' name=ID '{'(
			'nodes' ':' (nodes+=NodeInstance ';')*
		| 'subsystems' ':' (subsystems+=SystemInstance ';')*
		)*
	'}'
;

// !MESSAGE org.eclipse.xtext.linking.lazy.LazyLinkingResource
// An element of type SystemInstanceImpl is not assignable to the reference SystemReference.subsystem

SystemInstance: type=[SystemDefinition] name=ID;

SystemReference: system=[SystemInstance] (hasSubsystem?='.' subsystem=[SystemInstance])?;

NodeInstanceReference: belongingSystem=SystemReference '->' node=[NodeInstance];

DeploymentStatement:
	'deploys' nodes=NodeInstanceReference 'on' platform=[PlatformInstance] ';'
;

Deployment: {Deployment} 'deployment' '{'
		('platform' platforms+=PlatformInstance ';')*
		('system' systems+=SystemInstance ';')*
		(deployments+=DeploymentStatement)*
	'}'
;

PlatformInstance: name=ID;



